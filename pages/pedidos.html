<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mis Pedidos</title>
  <link rel="stylesheet" href="../CSS/navbar.css" />
  <link rel="stylesheet" href="../CSS/global.css">
  <link rel="stylesheet" href="../CSS/admin.css" />
  <!-- ✅ Font Awesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="logo">
        <img src="../assets/images/logo.jpg" alt="Logo" />
        <span class="brand-name">FastFoodExpress</span>
      </div>
      <div class="nav-actions">
        <ul class="nav-links">
          <li><a href="../index.html">Inicio</a></li>
          <li><a href="productos.html">Menú</a></li>
          <li><a href="#contacto">Contacto</a></li>
        </ul>
        <button class="search-btn"><i class="fas fa-search"></i></button>
        <a href="perfil-cliente.html" class="user-profile-link" id="userProfileLink">
          <img src="../assets/images/user-avatar.png" alt="Perfil" class="user-avatar" id="navbarAvatar">
          <span class="user-name" id="navbarUserName">Mi Perfil</span>
          <i class="fas fa-chevron-down dropdown-icon"></i>
        </a>
        <a href="pedidos.html" class="cart-btn">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-count" id="cartCount">0</span>
        </a>
      </div>
    </div>
  </nav>

  <main class="admin-container">
    <h1>Mis Pedidos</h1>
    <table>
      <thead>
        <tr>
          <th>ID Pedido</th>
          <th>Fecha</th>
          <th>Productos</th>
          <th>Total</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody id="pedidos-body">
        <!-- Se llenará con JS -->
      </tbody>
    </table>
  </main>

  <script src="../JS/main.js"></script>
  <script>
    // Función para actualizar el estado del carrito
    function actualizarCarritoNavbar() {
      const cartCount = document.getElementById('cartCount');
      if (cartCount) {
        const pedidos = JSON.parse(localStorage.getItem('pedidos')) || [];
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        
        if (currentUser && pedidos.length > 0) {
          const misPedidos = pedidos.filter(p => p.cliente === currentUser.nombre);
          if (misPedidos.length > 0) {
            const ultimoPedido = misPedidos[misPedidos.length - 1];
            const estado = ultimoPedido.estado;
            
            // Contar productos en el último pedido
            let totalProductos = ultimoPedido.productos ? ultimoPedido.productos.length : 0;
            
            if (totalProductos > 0) {
              cartCount.textContent = totalProductos;
              cartCount.style.display = 'block';
            } else {
              cartCount.style.display = 'none';
            }
          } else {
            cartCount.style.display = 'none';
          }
        } else {
          cartCount.style.display = 'none';
        }
      }
    }

    // Función para cargar el perfil del usuario en la navbar
    function cargarPerfilNavbar() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const navbarAvatar = document.getElementById('navbarAvatar');
      const navbarUserName = document.getElementById('navbarUserName');
      
      if (currentUser) {
        navbarUserName.textContent = currentUser.nombre;
        if (currentUser.avatar) {
          navbarAvatar.src = currentUser.avatar;
        }
      } else {
        navbarUserName.textContent = 'Iniciar Sesión';
        navbarAvatar.src = '../assets/images/user-avatar.png';
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      actualizarCarritoNavbar();
      cargarPerfilNavbar();

      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const pedidos = JSON.parse(localStorage.getItem('pedidos')) || [];
      const pedidosBody = document.getElementById('pedidos-body');

      if (!currentUser) {
        pedidosBody.innerHTML = '<tr><td colspan="5">No has iniciado sesión.</td></tr>';
        return;
      }

      const misPedidos = pedidos.filter(p => p.cliente === currentUser.nombre);

      if (misPedidos.length === 0) {
        pedidosBody.innerHTML = '<tr><td colspan="5">No tienes pedidos aún.</td></tr>';
        return;
      }

      misPedidos.forEach(pedido => {
        let total = pedido.productos.reduce((sum, p) => sum + p.precio, 0);
        let productosNombres = pedido.productos.map(p => p.nombre).join(", ");

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${pedido.id}</td>
          <td>${pedido.fecha}</td>
          <td>${productosNombres}</td>
          <td>$${total.toFixed(2)}</td>
          <td><span class="estado-${pedido.estado}">${pedido.estado}</span></td>
        `;
        pedidosBody.appendChild(tr);
      });

      // Estilos para estados
      const style = document.createElement('style');
      style.textContent = `
        .estado-pendiente { color: #3498db; font-weight: bold; }
        .estado-enviado { color: #f39c12; font-weight: bold; }
        .estado-entregado { color: #27ae60; font-weight: bold; }
        .estado-cancelado { color: #e74c3c; font-weight: bold; }
      `;
      document.head.appendChild(style);
    });
  </script>
  <script src="../JS/carrito.js"></script>

</body>
</html>
